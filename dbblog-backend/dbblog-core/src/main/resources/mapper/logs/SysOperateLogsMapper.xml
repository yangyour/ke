<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dblearn.blog.mapper.logs.SysOperateLogsMapper">
    <resultMap id="BaseResultMap" type="cn.dblearn.blog.entity.logs.SysOperateLogs">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="created_at" jdbcType="TIMESTAMP" property="createdAt"/>
        <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="operator" jdbcType="VARCHAR" property="operator"/>
        <result column="operator_dep" jdbcType="VARCHAR" property="operatorDep"/>
        <result column="user_id" jdbcType="BIGINT" property="userId"/>
        <result column="event" jdbcType="VARCHAR" property="event"/>
        <result column="log_type" jdbcType="VARCHAR" property="logType"/>
        <result column="ip" jdbcType="VARCHAR" property="ip"/>
        <result column="login_name" jdbcType="VARCHAR" property="loginName"/>
    </resultMap>
    <sql id="Base_Column_List">
			tb.id,
			tb.created_at,
			tb.updated_at,
			tb.description,
			tb.operator,
			tb.operator_dep,
			tb.user_id,
			tb.log_type,
			tb.ip,
			tb.login_name
	</sql>

    <select id="findListByEntity" parameterType="cn.dblearn.blog.entity.logs.SysOperateLogs" resultMap="BaseResultMap">
        select tb.id,tb.created_at,tb.operator,tb.operator_dep,tb.description,tb.ip,tb.login_name,tb.site_id
        from sys_operate_logs as tb
        <where>
            <if test="logType!=null">
                and tb.log_type = #{logType}
            </if>
            <if test="loginName!=null and loginName!=''">
                and tb.login_name like CONCAT('%',#{loginName},'%')
            </if>
            <if test="ip!=null and ip!=''">
                and tb.ip like CONCAT('%',#{ip},'%')
            </if>
            <if test="queryfilter!=null and queryfilter.size>0">
                <if test="queryfilter['startTime']!=null and queryfilter['startTime']!=''">
                    <![CDATA[and tb.created_at >= #{queryfilter.startTime}]]>
                </if>
                <if test="queryfilter['endTime']!=null and queryfilter['endTime']!=''">
                    <![CDATA[and tb.created_at <= #{queryfilter.endTime}]]>
                </if>
            </if>
        </where>
        order by tb.created_at desc
    </select>

    <select id="selectById" parameterType="Long" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from sys_operate_logs as tb where tb.id=#{id}
    </select>

</mapper>
